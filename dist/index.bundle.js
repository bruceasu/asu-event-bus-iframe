!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var s in n)("object"==typeof exports?exports:e)[s]=n[s]}}(window,function(){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"isBrowserSupport",function(){return s}),n.d(t,"MESSAGE_TYPE",function(){return o}),n.d(t,"EventAgent",function(){return r}),n.d(t,"EventBus",function(){return i});const s=()=>{if(!window.postMessage)throw console.log("Your browser is not support."),{message:"Your browser is not support."}},o={TYPE_SUBSCRIBE:"subscribe",TYPE_UNSUBSCRIBE:"unsubscribe",TYPE_PUBLISH:"publish",TYPE_SENDTOAGENT:"send-to-agent"},r=function(){s(),this.listeners={},this.addListener=e=>{const t=e.eventName;this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e)},this.removeListener=e=>{const t=e.eventName;let n=this.listeners[t];if(n){for(let t=n.length-1;t>=0;t--){let s=n[t];s.origin===e.origin&&s.source===e.source&&n.splice(t,1)}0===n.length&&delete this.listeners[t]}},this.forward=e=>{const t=e.eventName;let n=this.listeners[t];n&&n.forEach(t=>{const n={eventName:e.eventName,payload:e.payload};t.source.postMessage(n,t.origin)})},this.localListeners={},this.publishLocal=(e,t,n)=>{(this.localListeners[e]||[]).forEach((e,s)=>{e.call(null,t,n)})};let e=this;function t(t){let n=t.data.type||"";n===o.TYPE_SUBSCRIBE?e.addListner({eventName:t.data.eventName,origin:t.origin,lastEventId:t.lastEventId,source:t.source,ports:t.ports}):n===o.TYPE_UNSUBSCRIBE?e.removeListener({eventName:t.data.eventName,origin:t.origin,lastEventId:t.lastEventId,source:t.source,ports:t.ports}):n===o.TYPE_PUBLISH?e.forward({eventName:t.data.eventName,payload:t.data.payload,from:{origin:t.origin,lastEventId:t.lastEventId,source:t.source,ports:t.ports}}):n===o.TYPE_SENDTOAGENT?e.publishLocal(t.data.eventName,t.data.payload,t.source):t.data.eventName&&e.publishLocal(t.data.eventName,t.data.payload,t.source)}return window.addEventListener?window.addEventListener("message",function(e){t(e)},!1):window.attachEvent&&window.attachEvent("onmessage",function(e){t(e)}),{on:function(e,t){this.localListeners[e]=this.localListeners[e]||[],this.localListeners[e].push(t)},off:function(e){delete this.localListeners[e]},publish:function(e,t){window.postMessage({type:o.TYPE_PUBLISH,eventName:e,payload:t},"*")},publishLocal:function(t,n){e.publishLocal(t,n,window)}}},i=function(){s(),this.listeners={},this.postMessage=window.parent?window.parent.postMessage.bind(window.parent):window.top?window.top.postMessage.bind(window.top):window.postMessage.bind(window),this.registerListener=(e,t,n)=>{let s=e.constructor.name;n=this.validateNumber(n||"any"),"Array"!==s&&(e=[e]),e.forEach(e=>{if("String"!==e.constructor.name)throw new Error("Only `String` and array of `String` are accepted for the event names!");this.listeners[e]=this.listeners[e]||[],this.listeners[e].push({callback:t,number:n}),this.postMessage({type:o.TYPE_SUBSCRIBE,eventName:e},"*")})},this.validateNumber=e=>{var t=e.constructor.name;if("Number"===t)return e;if("String"===t&&"any"===e.toLowerCase())return"any";throw new Error("Only `Number` and `any` are accepted in the number of possible executions!")},this.toBeRemoved=e=>{let t=e.number;return e.execution=e.execution||0,e.execution++,!("any"===t||e.execution<t)},this.dispatch=e=>{let t=e.data.eventName||"";this.listeners[t]&&this.listeners[t].forEach((n,s)=>{let o=n.callback;this.toBeRemoved(n)&&(this.listeners[t].splice(s,1),0===this.listeners[t].length&&this.postMessage({type:"unsubscribe",eventName:t},"*")),o.call(null,e.data.payload)})},window.addEventListener?window.addEventListener("message",e=>{this.dispatch(e)},!1):window.attachEvent&&window.attachEvent("onmessage",e=>{this.dispatch(e)});let e=this;return{on:function(t,n){e.registerListener.bind(e)(t,n,"any")},once:function(t,n){e.registerListener.bind(e)(t,n,1)},exactly:function(t,n,s){e.registerListener.bind(e)(n,s,t)},off:function(t){delete e.listeners[t]},detach:function(t,n){for(var s in e.listeners[t])!e.listeners[t].hasOwnProperty(s)||e.listeners[t][s].callback!==n&&void 0!==n||e.listeners[t].splice(s,1)},detachAll:function(){for(var t in e.listeners)e.listeners.hasOwnProperty(t)&&this.detach(t)},publish:function(t,n){e.postMessage({type:o.TYPE_PUBLISH,eventName:t,payload:n},"*")},sendToAgent(t,n){e.postMessage({type:o.TYPE_SENDTOAGENT,eventName:t,payload:n})},publishToAgent:function(t,n){e.postMessage({type:"",eventName:t,payload:n},"*")}}}}])});